<div *ngIf="loadingState$ | async as loadingState"
     class="login-sidebar">
  <div class="login-sidebar__header d-flex justify-content-between align-item-center">
    <div>Welcome to Nesto</div>
    <a class="link-hoverable"
       (click)="dialogRef.close()">
      <span class="material-symbols-outlined">
        close
      </span>
    </a>
  </div>

  <div *ngIf="mode === 'login'"
       class="login-sidebar__body"
       [formGroup]="loginForm">
    <h3 class="text-18 fw-300">SIGN IN</h3>
    <!-- <p>Please check your Email inbox (hoaivu.kan@gmail.com) for welcoming letter.</p>-->
    <p class="mt-3">Please log into your account to continue shopping.</p>

    <mat-form-field class="w-100 mt-32  text-16">
      <mat-label>Enter your email/phone number</mat-label>
      <input matInput
             (keyup.enter)="login()"
             formControlName="userName">
    </mat-form-field>

    <p *ngIf="getError(loginForm, 'userName','required')"
       class="text-danger error-message">This field is required</p>

    <p *ngIf="getError(loginForm, 'userName','patternError')"
       class="text-danger error-message">Invalid phone number or
      email</p>

    <mat-form-field class="w-100 text-16">
      <mat-label>Enter password</mat-label>
      <input type="password"
             matInput
             (keyup.enter)="login()"
             formControlName="password">
    </mat-form-field>

    <p *ngIf="getError(loginForm, 'password','required')"
       class="text-danger error-message">This field is required</p>

    <p *ngIf="globalError$ | async as error"
       class="text-danger fs-18"> {{ error }}</p>


    <button class="nesto-btn primary big w-100 mt-50"
            [ngClass]="{'loading': loadingState === 'Loading'}"
            (click)="login()">LOGIN</button>

    <button class="nesto-btn outline big w-100 mt-16"
            [ngClass]="{'loading': loadingState === 'Loading'}"
            (click)="changeMode('signup')">SIGN UP</button>
  </div>

  <div *ngIf="mode === 'signup'"
       class="login-sidebar__body"
       [formGroup]="signupForm">
    <h3 class="text-18 fw-300">CREATE NEW ACCOUNT</h3>
    <p class="mt-3">Nesto gives you 200,000 for your first order.</p>
    <mat-form-field class="w-100 mt-32 text-16 ">
      <mat-label>Enter your email/phone number</mat-label>
      <input matInput
             formControlName="userName">
    </mat-form-field>
    <p *ngIf="getError(signupForm, 'userName','required')"
       class="text-danger error-message">This field is required</p>

    <p *ngIf="getError(signupForm, 'userName','patternError')"
       class="text-danger error-message">Invalid phone number or
      email</p>

    <mat-form-field class="w-100 text-16 ">
      <mat-label>Enter password</mat-label>
      <input type="password"
             matInput
             formControlName="password">
    </mat-form-field>

    <p *ngIf="getError(signupForm, 'password','required')"
       class="text-danger error-message">This field is required</p>


    <mat-form-field class="w-100 text-16">
      <mat-label>Re-enter password</mat-label>
      <input type="password"
             matInput
             (keyup.enter)="createAccount()"
             formControlName="confirmPassword">
    </mat-form-field>


    <p *ngIf="getError(signupForm, 'confirmPassword','required')"
       class="text-danger error-message">This field is
      required</p>

    <p *ngIf="getError(signupForm, 'confirmPassword','confirm')"
       class="text-danger error-message">Invalid confirmation
      password</p>

    <p *ngIf="globalError$ | async as error"
       class="text-danger fs-18"> {{ error }}</p>

    <button class="nesto-btn primary big w-100 mt-50"
            [ngClass]="{'loading': loadingState === 'Loading'}"
            (click)="createAccount()">CREATE</button>

    <button class="nesto-btn outline big w-100 mt-16"
            [ngClass]="{'loading': loadingState === 'Loading'}"
            (click)="changeMode('login')">LOGIN</button>
  </div>

  <div *ngIf="mode === 'update-personal-data'"
       class="login-sidebar__body">
    <h3 class="text-18 fw-300">PERSONAL INFORMATION</h3>
    <div class="d-flex justify-content-between mt-3">
      <p>Please fill in to complete your account information</p>
      <a class="nesto-link link-hoverable"
         (click)="dialogRef.close()">Later</a>
    </div>

    <div class="w-100 mt-32"
         [formGroup]="userProfileForm"
         style="--input-font-size: 14px;">

      <mat-form-field class="w-100 text-14">
        <mat-label>Full name</mat-label>
        <input type="text"
               formControlName="fullName"
               matInput>
      </mat-form-field>

      <mat-form-field class="w-100 text-14">
        <mat-label>Email</mat-label>
        <input type="email"
               formControlName="email"
               matInput>
      </mat-form-field>

      <p *ngIf="getError(userProfileForm, 'email','required')"
         class="text-danger error-message">This field is required</p>

      <p *ngIf="getError(userProfileForm, 'email','emailError')"
         class="text-danger error-message">Invalid email</p>

      <mat-form-field class="w-100 text-14">
        <mat-label>Phone number</mat-label>
        <input type="tel"
               formControlName="phoneNumber"
               matInput>
      </mat-form-field>

      <p *ngIf="getError(userProfileForm, 'phoneNumber','required')"
         class="text-danger error-message">This field is required</p>

      <p *ngIf="getError(userProfileForm, 'phoneNumber','phoneError')"
         class="text-danger error-message">Invalid phone number</p>

      <div class="form-item">
        <p class="label">Gender</p>

        <div class="d-flex flex-grow-1 align-items-center">
          <mat-radio-group class="w-100 d-flex justify-content-between text-14"
                           aria-label="Select an gender"
                           formControlName="gender">
            <mat-radio-button value="Male">Male</mat-radio-button>
            <mat-radio-button value="Female">Female</mat-radio-button>
            <mat-radio-button value="Other">Other</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>

      <div class="form-item">
        <p class="label">Date of Birth</p>

        <div class="d-flex flex-grow-1 align-items-center">
          <mat-form-field class="w-100 text-14"
                          (click)="picker.open()"
                          appearance="outline">
            <mat-label>Choose a date</mat-label>
            <input [matDatepicker]="picker"
                   formControlName="dateOfBirth"
                   matInput>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>

      <button class="nesto-btn primary big w-100 mt-32"
              [ngClass]="{'loading': loadingState === 'Loading'}"
              (click)="updateProfile()">UPDATE</button>
    </div>

  </div>

  <div *ngIf="mode === 'update-data'"
       class="login-sidebar__body">
    <h3 class="text-18 fw-300">DELIVERY INFORMATION</h3>
    <div class="d-flex justify-content-between mt-3">
      <p>Please fill in to complete your account information</p>
      <a class="nesto-link link-hoverable"
         (click)="dialogRef.close()">Later</a>
    </div>

    <div class="w-100 mt-32">
      <mix-address-input></mix-address-input>
    </div>

    <button class="nesto-btn primary big w-100 mt-32"
            [ngClass]="{'loading': loadingState === 'Loading'}"
            (click)="submitAddress()">UPDATE</button>
  </div>
</div>
