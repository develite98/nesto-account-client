<div *ngIf="(loadingState$ | async) as state"
     class="nesto-container cart-manage">
  <span class="nesto-breadcrumb">
    <a href="/">HOME</a> / <a href="#">CART</a>
  </span>

  <div class="cart-manage__title">CART({{currentOrder.length}})</div>
  <div class="d-none d-md-block">
    <div *ngIf="state === 'Success'"
         class="table-container">
      <table *ngIf="dataSource.length"
             [dataSource]="dataSource"
             mat-table>
        <!-- Products Column -->
        <ng-container matColumnDef="Products">
          <th *matHeaderCellDef
              mat-header-cell> Products </th>
          <td *matCellDef="let element"
              class="product-cart-title"
              mat-cell>
            <mat-checkbox class="checkbox"
                          [checked]="element.isActive"
                          (change)="checkedItemChange($event, element)">
            </mat-checkbox>

            <img src="{{element.image}}">

            <div>
              <p class="text-12 fw-500 reset-margin"> {{element.title}} </p>
              <span class="text-blur text-uppercase text-10">SKU: {{element.sku}}</span>
              <ng-container *ngIf="isSoldOut(element)">
                <div><span class="text-danger">SOLD OUT</span></div>
              </ng-container>

              <ng-container *ngIf="isOverStock(element)">
                <div><span class="text-danger">Over quantity in stock</span></div>
              </ng-container>
            </div>
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="Category">
          <th *matHeaderCellDef
              mat-header-cell> Category </th>
          <td *matCellDef="let element"
              mat-cell>
            <span>{{ element.variantColor ?? 'N/A' }}<span *ngIf="element.variantSize">, {{ element.variantSize ?? ''}}</span></span>
            <br>
            <a class="nesto-link text-12 mt-3"
               (click)="gotoPost(element)">View category</a>
          </td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="Price">
          <th *matHeaderCellDef
              mat-header-cell> Price </th>
          <td *matCellDef="let element"
              mat-cell>
            <mix-money-display [currencySize]="12"
                               [textSize]="14"
                               [value]="element.price"></mix-money-display>
          </td>
        </ng-container>

        <ng-container matColumnDef="Unit">
          <th *matHeaderCellDef
              mat-header-cell> Unit </th>
          <td *matCellDef="let element"
              mat-cell> {{ element.post?.additionalData?.unit ?? 'piece' }} </td>
        </ng-container>

        <ng-container matColumnDef="Quantity">
          <th *matHeaderCellDef
              mat-header-cell> Quantity </th>
          <td *matCellDef="let element"
              mat-cell>
            <mix-input-number [(value)]="element.quantity"
                              [disabled]="isSoldOut(element)"
                              (valueChange)="itemQuantityChange(element, $event)"></mix-input-number>
          </td>
        </ng-container>

        <ng-container matColumnDef="Subtotal">
          <th *matHeaderCellDef
              mat-header-cell> Subtotal </th>
          <td *matCellDef="let element"
              mat-cell>
            <mix-money-display [currencySize]="12"
                               [textSize]="14"
                               [value]="element.total"></mix-money-display>
          </td>
        </ng-container>

        <ng-container matColumnDef="Action">
          <th *matHeaderCellDef
              mat-header-cell></th>
          <td *matCellDef="let element"
              mat-cell>
            <a class="link-hoverable text-12"
               (click)="removeItem(element.id)">Remove</a>
          </td>
        </ng-container>

        <tr *matHeaderRowDef="displayedColumns"
            mat-header-row></tr>
        <tr *matRowDef="let row; columns: displayedColumns;"
            mat-row></tr>
      </table>

      <div *ngIf="!dataSource.length"
           class="w-100">
        <h2 class="text-36 fw-100 mt-24 mt-xs-unset">Your cart is empty.</h2>

        <p>Visit our <a class="link-hoverable"
             href="/products">Product</a> page</p>
      </div>
    </div>

    <div *ngIf="state === 'Loading'"
         class="row">
      <mix-skeleton-loading type="table"></mix-skeleton-loading>
    </div>
  </div>

  <div class="d-block d-md-none">
    <div *ngIf="state === 'Loading'"
         class="w-100">
      <mix-skeleton-loading></mix-skeleton-loading>
    </div>

    <div *ngIf="state === 'Success'"
         class="order-widget">
      <mix-cart-item *ngFor="let order of dataSource"
                     [order]="order"
                     (checkedChange)="checkedItemChange($event, order)"
                     (quantityChange)="itemQuantityChange(order, $event)"
                     (remove)="removeItem(order.id)"></mix-cart-item>
    </div>

    <div *ngIf="state === 'Success' && !dataSource.length">
      <div class="w-100">
        <h2 class="text-36 fw-100 mt-24">Your cart is empty.</h2>

        <p>Visit our <a class="link-hoverable"
             href="#">Product</a> page</p>
      </div>
    </div>
  </div>

  <div *ngIf="dataSource.length"
       class="cart-checkout-btn-area row mt-50">
    <div class="col-12 col-md-8">
    </div>

    <div class="col-12 col-md-4">
      <div class="d-flex w-100 justify-content-between">
        <label class="text-18 fw-400">SUBTOTAL: </label> <label class="text-30 fw-500">
          <mix-money-display [currencySize]="26"
                             [textSize]="30"
                             [value]="currentSubTotal"></mix-money-display></label>
      </div>
      <div class="mt-50 w-100">
        <button class="nesto-btn w-100 secondary big"
                [ngClass]="{'disabled': !canCheckOut}"
                (click)="checkout()">CHECK OUT</button>
      </div>
    </div>
  </div>
</div>
